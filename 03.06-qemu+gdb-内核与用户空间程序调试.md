https://docs.sel4.systems/projects/sel4-tutorials/debugging-guide.html

这个页面是从这里进入：![image-20220305002931393](images/03.06-qemu+gdb-%E5%86%85%E6%A0%B8%E4%B8%8E%E7%94%A8%E6%88%B7%E7%A9%BA%E9%97%B4%E7%A8%8B%E5%BA%8F%E8%B0%83%E8%AF%95.assets/image-20220305002931393.png)

# 单独构建内核，开启debug模式的方法

解压sel4-12.1.0.

新建一个文件夹build，不要与原来混在一起。

在我的sel4-12.1.0文件夹同级目录下，新建一个文件夹build，不要与原来混在一起，进入build

```
mkdir build && cd build
```

然后输入cmake命令，编译，加入参数 **`-DCMAKE_BUILD_TYPE=Debug`**

```
cmake -DCMAKE_BUILD_TYPE=Debug -DCROSS_COMPILER_PREFIX= -DCMAKE_TOOLCHAIN_FILE=../seL4-12.1.0/gcc.cmake -G Ninja -C ../seL4-12.1.0/configs/X64_verified.cmake ../seL4-12.1.0/
```

ninja命令打包出kernel：

```
ninja kernel.elf
```

# sel4test的x86_64版本debug——内核调试

还是在sel4test的目录下：

如果你忘了什么是sel4test目录，这是构建方法：

```
mkdir sel4test
cd sel4test
repo init -u https://github.com/seL4/sel4test-manifest.git #此处加上-b refs/tags/12.1.0跑不通
repo sync
ls
```

然后创建build_x86_64

```
mkdir build_x86_64
cd build_x86_64
../init-build.sh -DPLATFORM=x86_64 -DSIMULATION=TRUE #此处默认是debug build模式，如果加-DRELEASE，表示release build模式
ninja
```

然后启动模拟，qemu附加命令：

```
./simulate --extra-qemu-args="-S -s"
```

在另一命令行窗口，启动gdb：

```
gdb kernel/kernel.elf
```

并在(gdb)中连接gdbserver，并打断点调试即可。

```
target remote:1234
```

![image-20220306003658470](images/03.06-qemu+gdb-%E5%86%85%E6%A0%B8%E4%B8%8E%E7%94%A8%E6%88%B7%E7%A9%BA%E9%97%B4%E7%A8%8B%E5%BA%8F%E8%B0%83%E8%AF%95.assets/image-20220306003658470.png)

这里与网上不同的是，gdbserver和gdb好像没有指定同一个文件。经过观察和分析，我们认为，kernel/kernel.elf与images下的内核大致相同，但是images文件夹下可能有些更改。

# sel4test的x86_64版本debug——测试程序调试

与上文类似，不过本地gdb指定的是：

```
${CROSS_COMPILER_PREFIX}gdb projects/sel4test/apps/sel4test-driver/sel4test-driver
```

并在(gdb)中连接gdbserver，并打断点调试即可。

```
target remote:1234
```

这里gdb指定的文件与images下的文件不同，可能是上文的类似原因。