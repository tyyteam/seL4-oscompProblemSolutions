# 2022.2.28 seL4test编译并运行到raspi3-参照洋哥的又写了一遍

配置依赖：[Host Dependencies | seL4 docs](https://docs.sel4.systems/projects/buildsystem/host-dependencies.html)

按照教程执行命令：[Raspberry PI 3 Model B and Model B+ | seL4 docs](https://docs.sel4.systems/Hardware/Rpi3.html)

```
mkdir sel4test && cd sel4test
repo init -u https://github.com/seL4/sel4test-manifest.git
repo sync
mkdir build-rpi && cd build-rpi
../init-build.sh -DPLATFORM=rpi3 -DBAMBOO=TRUE -DAARCH32=TRUE##此处待讨论
ninja
```

上面待讨论处的参数：[Configuring and building an seL4 project | seL4 docs](https://docs.sel4.systems/projects/buildsystem/using.html)。

执行：

```
./simulate
```

![image-20220228164531963](C:/Users/Liu%20Qingtao/AppData/Roaming/Typora/typora-user-images/image-20220228164531963.png)

图来自洋哥:)

下文大量来自洋哥

参考qemu文档设置参数[Invocation — QEMU documentation](https://www.qemu.org/docs/master/system/invocation.html#)。

运行生成的simulate会有点问题，把-machine raspi3 改成-machine raspi3b 就好了，然后就可以直接运行命令

```
qemu-system-aarch64 -machine raspi3b -m size=1024M -kernel images/sel4test-driver-image-arm-bcm2837 -serial null -serial mon:stdio
```

* -kernel xx指定内核映像文件，直接引导，不需要像模拟真机那样放到磁盘中再通过bootloader引导
* 其中-serial为将虚拟串行端口重定向到主机字符设备 ，树莓派3b共两个串口，第一个串口暂时用不着重定向为无效设备-serial null ，第二个串口重定向到本机的标准输入输出-serial mon:stdio ，以上两个参数顺序不能调换，如改成-serial mon:stdio -serial null 就是把没用的1号串口重定向给stdio了，而把实际要用的2号串口当做无效设备了，亲测，不信你试试(此处我来试试)
  * 如果不加两个serial，则会黑屏无显示。