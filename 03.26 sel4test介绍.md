
# seL4test 设计

seL4test是一个seL4测试框架，在seL4上运行测试套件。它被使用
以测试内核和用户代码。

## 动机

即使seL4是经过验证的微内核，我们仍然需要一个全面的集合
的测试，这些测试可以用作轻松检查内核是否正常工作的方法。
以下是一些原因：

- 验证需要很长时间：运行证明需要花费许多小时，能够
  更快地运行测试意味着由于错误更快，开发速度可以更快
  检测和校正。
- 验证并不涵盖所有配置和平台：测试套件是
  能够覆盖更大范围的配置和平台。
- 验证有假设：测试可用于尝试和检查是否有任何验证
  假设是不正确的。
- 验证正确的配置和工具链：测试可用于完整性检查
  生成配置和已安装的主机依赖项集是否正常工作。
- 帮助阐明内核 API 的正确操作：测试可用于演示
  期望接口如何更精确地处理边缘情况。
- 用作非内核代码的测试运行程序：对于使用 seL4 运行的任何其他代码，
  需要有一种方法来轻松测试它是否正常工作。


## 目标

为了达到上述目的，添加到sel4test的每个测试都应该有以下几点
属性大致采用以下优先级排序：
- 测试独立性：一个测试的行为不应受到其他测试运行方式的影响。
- 测试在成功或失败方面是明确的：测试的成功应表明
  某些内容工作正常，而失败之处在于某些内容无法正常工作。测试
  不应使用成功来表示某些事情可能有效，或者失败来表明
  有些东西可能不起作用（参见：排除中间定律）。
- 测试是可重复的：测试可以是确定性的，重新运行它应该会导致
  相同的结果。
- 测试是独立的，不依赖于外部交互：测试不能具有
  其测试环境尚未提供的任何外部依赖项。
- 测试快速完成：每个测试应快速完成，因为整个测试持续时间
  是所有单个测试的累积。每个测试不应超过10ms。
- 测试很容易理解：学习和理解测试的行为不应该
  需要很大的认知负荷。
- 测试易于添加/删除：添加和删除测试是一种常见操作，并且
  执行起来应该不昂贵。这包括运行测试以确认它
  功能正常。

此外，一个普遍的目标是，至少有同样多的测试
验证被测系统是否正常运行。


## 特点

此项目具有以下组件/功能：

### 根任务

`sel4test-driver`是一个可执行文件，作为seL4根任务运行。它期望
被赋予seL4功能的初始集合（"seL4_Bootinfo_t"），并使用它
引导自己的系统环境，并为之创建测试环境
运行所有测试。 它具有用于创建的基本操作系统功能
并销毁多个测试运行并支持不同的测试环境。

### 测试环境

测试环境定义测试在运行时可以访问哪些资源。环境
可能具有在测试之前和之后运行的启动和关闭过程
正在运行。测试定义具有用于链接
使用所需的环境进行测试。

#### Bootstrap 环境

每个测试环境在与根任务不同的"进程"中运行测试。这
是将测试彼此隔离。但是，存在一个"引导"测试环境
在根任务中运行测试。此环境用于运行测试的测试
用于创建和与不同环境"进程"通信的功能。


### 测试

测试是引用其环境调用的函数。每次测试
执行一组生成结果的操作。结果与预期的结果进行比较
值来确定成功或失败。测试预期将成功终止
或失败结果，不允许永远运行。

### 测试的选择

对测试的引用将添加到特殊链接器部分和根任务
使用它在运行时选择和运行测试。测试运行的选择基于
是否启用了测试，以及测试名称是否配置为与根任务的正则表达式匹配
. 测试应自动选择是否启用
基于生成时的生成配置。正则表达式用于进一步过滤
运行哪些测试。默认正则表达式为".*"，用于选择所有已启用的测试。

### 测试的运行

测试按顺序运行，并在每次测试运行之间重置其测试环境。
可以配置 roottask 是在测试失败情况下停止还是继续运行。
测试失败不应导致整个应用程序崩溃。这是不强制执行的
大多数测试环境，因为许多测试都在测试内核机制，并且可能
需要允许他们使系统崩溃的权限。测试需要这样写
将此结果降至最低。

### 报告结果

测试结果通过测试调用的函数报告，这些函数由
通用测试接口。根任务可以选择如何报告测试结果
基于其配置。某些报告格式应是可计算机解析的，以支持
测试运行自动化。人类可读的格式也应该可用。

## 其他

seL4bench是另一个类似于seL4test的应用程序，用于运行
在 seL4 上进行基准测试。