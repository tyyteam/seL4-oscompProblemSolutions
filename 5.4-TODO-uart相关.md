# 参考

左侧是起始地址，右侧是地址长度

![image-20220504102331765](images/5.4-TODO-uart%E7%9B%B8%E5%85%B3.assets/image-20220504102331765.png)

uart上有很多寄存器，类似于如下方式基址加偏移

![image-20220504102521576](images/5.4-TODO-uart%E7%9B%B8%E5%85%B3.assets/image-20220504102521576.png)



A2~0是寄存器号，8个寄存器

![image-20220504102805084](images/5.4-TODO-uart%E7%9B%B8%E5%85%B3.assets/image-20220504102805084.png)





读与写

![image-20220504103111476](images/5.4-TODO-uart%E7%9B%B8%E5%85%B3.assets/image-20220504103111476.png)



初始化，设置波特率等

![image-20220504104006759](images/5.4-TODO-uart%E7%9B%B8%E5%85%B3.assets/image-20220504104006759.png)

![image-20220504104808870](images/5.4-TODO-uart%E7%9B%B8%E5%85%B3.assets/image-20220504104808870.png)



![image-20220504104922762](images/5.4-TODO-uart%E7%9B%B8%E5%85%B3.assets/image-20220504104922762.png)



# 思考

在kernel/src/arch/loongarch/machine/io.c下，是kerneldebug信息输入输出函数的接口，考虑将其中sbi的相关函数修改成uart的操作。

需要打开debug_build，printing。在machine/io.h下被调用。



uart.h

![image-20220504115505215](images/5.4-TODO-uart%E7%9B%B8%E5%85%B3.assets/image-20220504115505215.png)



龙芯3A5000手册中有uart内容。

mips下的文件

![image-20220504141433361](images/5.4-TODO-uart%E7%9B%B8%E5%85%B3.assets/image-20220504141433361.png)



# 修改

* 添加kernel/src/drivers/serial/loongson3A5000-uart.c文件。kernel/include/drivers/uart.h会调用架构相关的uart操作函数。可以操作uart_console_putchar，uart_drv_getchar两个函数。
* 在kernel/src/arch/loongarch/machine/io.c下，调用uart_console_putchar和uart_drv_getchar两个函数。
* 添加支持：kernel/src/drivers/serial/config.cmake。
* 添加kernel/tools/dts/3A5000.dts文件。
* kernel/tools/hardware.yml添加支持。
* 

参考：

* tools/seL4/elfloader-tool/src/drivers/uart/bcm-uart.c
* 在kernel/src/drivers/config.cmake中，会比较已有字符串列表compatibility_strings，因此需要向字符串列表添加龙芯支持。
  * kernel/config.cmake中，file(READ "${compatibility_outfile}" compatibility_strings)，从compatibility_outfile读出变量。
  * kernel/config.cmake中，99行设置了输出文件compatibility_outfile的路径，在build的kernel下
  * 






？添加支持：kernel/tools/hardware.yml

