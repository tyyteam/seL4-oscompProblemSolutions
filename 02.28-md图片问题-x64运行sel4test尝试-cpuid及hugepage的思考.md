# 解决了github markdown文件显示问题

使用相对路径，建个文件夹。

![image-20220301105236442](images/x64-%E8%BF%90%E8%A1%8Csel4.assets/image-20220301105236442.png)

建议本地路径设置为：

![QQ图片20220301110558](images/x64-%E8%BF%90%E8%A1%8Csel4.assets/QQ%E5%9B%BE%E7%89%8720220301110558.png)

然后就可以把本地md文件，以及images文件夹下{filename}.assets文件夹拖入github在线vscode中。



# 树莓派可能有参考的内容

这个是树莓派OS跑树莓派kernel。[QEMU搭建树莓派环境_Yale的博客-CSDN博客_qemu 树莓派](https://blog.csdn.net/yalecaltech/article/details/90524245)。

* 它是把树莓派镜像挂载，mnt命令类似于创建一个设备，这个设备作为内核所在的磁盘，qemu模拟出来机器，加载磁盘，启动。



# 编译x64上可运行的sel4test

官方文档：[PC99 | seL4 docs](https://docs.sel4.systems/Hardware/IA32)。

```
repo init -u https://github.com/seL4/sel4test-manifest.git
repo sync
mkdir cbuild && cd cbuild
../init-build.sh -DPLATFORM=x86_64 -DSIMULATION=1
ninja
./simulate
```



修改simulate.py文件，让其打印命令，并停止其执行，如下：

![image-20220228205056086](images/x64-%E8%BF%90%E8%A1%8Csel4.assets/image-20220228205056086.png)

**得到最初的qemu模拟指令：**

```
qemu-system-x86_64  -cpu Nehalem,-vme,+pdpe1gb,-xsave,-xsaveopt,-xsavec,-fsgsbase,-invpcid,+syscall,+lm,enforce -nographic -serial mon:stdio -m size=3G  -kernel images/kernel-x86_64-pc99 -initrd images/sel4test-driver-image-x86_64-pc99
```

* 当去掉上述命令的images参数：

```
qemu-system-x86_64  -cpu Nehalem,-vme,+pdpe1gb,-xsave,-xsaveopt,-xsavec,-fsgsbase,-invpcid,+syscall,+lm,enforce -nographic -serial mon:stdio -m size=3G  -kernel images/kernel-x86_64-pc99
```

![image-20220228210734748](images/x64-%E8%BF%90%E8%A1%8Csel4.assets/image-20220228210734748.png)

好像initrd的作用：[使用Qemu仿真内核（2）——制作内存磁盘文件系统(initrd) - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/55963250)。

* 当去掉cpu：

```
qemu-system-x86_64 -serial mon:stdio -m size=8G  -kernel images/kernel-x86_64-pc99
```

![image-20220228211805203](images/x64-%E8%BF%90%E8%A1%8Csel4.assets/image-20220228211805203.png)

此时也要boot from rom，initrd不能去掉。

* initrd保持，cpu去掉

```
qemu-system-x86_64 -serial mon:stdio -m size=3G  -kernel images/kernel-x86_64-pc99 -initrd images/sel4test-driver-image-x86_64-pc99
```

![image-20220301120836714](images/0.28-md%E5%9B%BE%E7%89%87%E9%97%AE%E9%A2%98-x64%E8%BF%90%E8%A1%8Csel4test%E5%B0%9D%E8%AF%95.assets/image-20220301120836714.png)

如果不指定cpu，出现huge page的错误。关于huge page的内容：[kvm虚拟化 硬件功能 大页（Huge Page）-baochenggood-ChinaUnix博客](http://blog.chinaunix.net/uid-26719405-id-4139124.html)。为什么要指定CPU呢？

从官网文档[Invocation — QEMU documentation](https://www.qemu.org/docs/master/system/invocation.html)，输入qemu-system-x86_64 -cpu help，查看支持的cpu和cpu flags。

[SGX技术的分析和研究 (jos.org.cn)](http://www.jos.org.cn/html/2018/9/5594.htm#outline_anchor_6)讲了sgx技术，epc。

在qemu命令中增加或减少cpuid：[[daily\][qemu][kvm] qemu增加减少CPUID - toong - 博客园 (cnblogs.com)](https://www.cnblogs.com/hugetong/p/7773526.html)。具体特性可以根据qemu-system-x86_64 -cpu help查看支持的flags，并在intel 的开发手册中查对应指令的解释。所以，如果不指定cpu的参数，也就是没有那个+pdpe1gb命令，会报错不支持huge page。





其他可能有用的东西：

[1173218 – Improve QEMU error message when huge pages are incorrectly configured (redhat.com)](https://bugzilla.redhat.com/show_bug.cgi?id=1173218).

[【一顿操作】用Grub2命令行引导启动Windows10_hikkilover的博客-CSDN博客_grub2引导win10](https://blog.csdn.net/hikkilover/article/details/82290873)

[linux 内核启动Initramfs与initrd 及其挂载_老鹰不捉小鸡-CSDN博客_initrd 加载内核](https://blog.csdn.net/weixin_43836778/article/details/90205177)

